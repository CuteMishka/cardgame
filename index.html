<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ò–º–ø–µ—Ä–∞—Ç–æ—Ä - –ö–∞—Ä—Ç–æ—á–Ω–∞—è –∏–≥—Ä–∞</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <style>
        @keyframes cardFlip {
            0% { transform: rotateY(0deg) scale(1); }
            50% { transform: rotateY(90deg) scale(1.1); }
            100% { transform: rotateY(0deg) scale(1); }
        }
        
        @keyframes cardSlide {
            0% { transform: translateY(-20px); opacity: 0; }
            100% { transform: translateY(0); opacity: 1; }
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .card-flip {
            animation: cardFlip 0.6s ease-in-out;
        }
        
        .card-slide {
            animation: cardSlide 0.4s ease-out;
        }
        
        .pulse-anim {
            animation: pulse 2s ease-in-out infinite;
        }
        
        .card-hover {
            transition: all 0.2s ease;
        }
        
        .card-hover:hover {
            transform: translateY(-10px) scale(1.05);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
        }
    </style>
</head>
<body class="bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 min-h-screen">
    <div id="app"></div>

    <script>
        // ==================== FIREBASE CONFIG ====================
        const firebaseConfig = {
            apiKey: "AIzaSyBFjleDsbPvsNnlkKp9q5a-Xq3IyTus23o",
            authDomain: "card-game-d1fa1.firebaseapp.com",
            databaseURL: "https://card-game-d1fa1-default-rtdb.firebaseio.com",
            projectId: "card-game-d1fa1",
            storageBucket: "card-game-d1fa1.firebasestorage.app",
            messagingSenderId: "897674662962",
            appId: "1:897674662962:web:c7824186c666e30cacd82b",
            measurementId: "G-W9KWPSR8K8"
        };

        let database = null;
        const isFirebaseConfigured = firebaseConfig.apiKey !== "YOUR_API_KEY_HERE";
        
        if (isFirebaseConfigured) {
            firebase.initializeApp(firebaseConfig);
            database = firebase.database();
        }

        // ==================== GAME LOGIC ====================
        const CARDS = {
            E: { name: '–ò–º–ø–µ—Ä–∞—Ç–æ—Ä', emoji: 'üëë', color: 'from-amber-600 to-yellow-700', beats: 'C' },
            C: { name: '–ì—Ä–∞–∂–¥–∞–Ω–∏–Ω', emoji: 'üë•', color: 'from-blue-600 to-indigo-700', beats: 'S' },
            S: { name: '–†–∞–±', emoji: 'üîó', color: 'from-gray-500 to-gray-700', beats: 'E' }
        };

        const INITIAL_DECK = ['E', 'S', 'C', 'C', 'C'];

        let state = {
            screen: 'menu',
            gameId: '',
            playerName: '',
            isHost: false,
            myCards: [...INITIAL_DECK],
            opponentCards: 5,
            myChoice: null,
            opponentChoice: null,
            myScore: 0,
            opponentScore: 0,
            round: 1,
            opponentName: '–ü—Ä–æ—Ç–∏–≤–Ω–∏–∫',
            waitingForOpponent: false,
            roundResult: '',
            error: '',
            showModal: null,
            animateCards: false
        };

        // ==================== FIREBASE FUNCTIONS ====================
        function saveGame(gameId, data) {
            if (database) {
                database.ref('games/' + gameId).set(data);
            } else {
                localStorage.setItem('game_' + gameId, JSON.stringify(data));
                window.dispatchEvent(new Event('storage'));
            }
        }

        function watchGame(gameId, callback) {
            if (database) {
                database.ref('games/' + gameId).on('value', (snapshot) => {
                    callback(snapshot.val());
                });
            } else {
                const interval = setInterval(() => {
                    const data = localStorage.getItem('game_' + gameId);
                    if (data) callback(JSON.parse(data));
                }, 500);
                return () => clearInterval(interval);
            }
        }

        function loadGame(gameId, callback) {
            if (database) {
                database.ref('games/' + gameId).once('value').then((snapshot) => {
                    callback(snapshot.val());
                });
            } else {
                const data = localStorage.getItem('game_' + gameId);
                callback(data ? JSON.parse(data) : null);
            }
        }

        // ==================== GAME FUNCTIONS ====================
        function determineWinner(card1, card2) {
            if (card1 === card2) return 'draw';
            if (CARDS[card1].beats === card2) return 'player';
            return 'opponent';
        }

        function showCreateModal() {
            state.showModal = 'create';
            state.error = '';
            render();
        }

        function showJoinModal() {
            state.showModal = 'join';
            state.error = '';
            render();
        }

        function closeModal() {
            state.showModal = null;
            state.error = '';
            render();
        }

        function createGame() {
            const nameInput = document.getElementById('createName');
            const name = nameInput?.value.trim();
            
            if (!name) {
                state.error = '–í–≤–µ–¥–∏—Ç–µ –∏–º—è!';
                render();
                return;
            }

            const gameId = Math.random().toString(36).substr(2, 6).toUpperCase();
            const gameData = {
                player1Name: name,
                player2Name: null,
                currentRound: 1,
                player1Choice: null,
                player2Choice: null,
                player1Cards: [...INITIAL_DECK],
                player2Cards: [...INITIAL_DECK],
                createdAt: Date.now()
            };

            saveGame(gameId, gameData);

            state.gameId = gameId;
            state.playerName = name;
            state.isHost = true;
            state.screen = 'lobby';
            state.myCards = [...INITIAL_DECK];
            state.showModal = null;
            
            render();
            startWatching();
        }

        function joinGame() {
            const nameInput = document.getElementById('joinName');
            const codeInput = document.getElementById('joinCode');
            const name = nameInput?.value.trim();
            const gameId = codeInput?.value.trim().toUpperCase();
            
            if (!name) {
                state.error = '–í–≤–µ–¥–∏—Ç–µ –∏–º—è!';
                render();
                return;
            }

            if (!gameId) {
                state.error = '–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –∏–≥—Ä—ã!';
                render();
                return;
            }

            loadGame(gameId, (game) => {
                if (!game) {
                    state.error = '–ò–≥—Ä–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞';
                    render();
                    return;
                }

                if (game.player2Name) {
                    state.error = '–ò–≥—Ä–∞ —É–∂–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∞';
                    render();
                    return;
                }

                game.player2Name = name;
                saveGame(gameId, game);

                state.gameId = gameId;
                state.playerName = name;
                state.opponentName = game.player1Name;
                state.isHost = false;
                state.screen = 'playing';
                state.myCards = [...INITIAL_DECK];
                state.showModal = null;

                render();
                startWatching();
            });
        }

        function startWatching() {
            watchGame(state.gameId, (game) => {
                if (!game) return;

                if (state.screen === 'lobby' && game.player2Name) {
                    state.opponentName = game.player2Name;
                    state.screen = 'playing';
                    render();
                }

                if (state.screen === 'playing') {
                    const myRole = state.isHost ? 'player1' : 'player2';
                    const oppRole = state.isHost ? 'player2' : 'player1';

                    // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º –∫–æ–ª–æ–¥—ã –∏–∑ –±–∞–∑—ã
                    state.myCards = game[myRole + 'Cards'] || state.myCards;
                    state.opponentCards = (game[oppRole + 'Cards'] || []).length;

                    if (game[myRole + 'Choice'] && game[oppRole + 'Choice'] && !state.opponentChoice) {
                        const myCard = game[myRole + 'Choice'];
                        const oppCard = game[oppRole + 'Choice'];

                        state.myChoice = myCard;
                        state.opponentChoice = oppCard;
                        state.waitingForOpponent = false;
                        state.animateCards = true;

                        const winner = determineWinner(myCard, oppCard);
                        if (winner === 'player') {
                            state.myScore++;
                            state.roundResult = '–í—ã –ø–æ–±–µ–¥–∏–ª–∏ –≤ —Ä–∞—É–Ω–¥–µ! üéâ';
                        } else if (winner === 'opponent') {
                            state.opponentScore++;
                            state.roundResult = '–ü—Ä–æ—Ç–∏–≤–Ω–∏–∫ –ø–æ–±–µ–¥–∏–ª üòî';
                        } else {
                            state.roundResult = '–ù–∏—á—å—è ‚öñÔ∏è';
                        }

                        render();

                        setTimeout(() => {
                            if (game.currentRound < 5) {
                                game.currentRound++;
                                game.player1Choice = null;
                                game.player2Choice = null;
                                saveGame(state.gameId, game);

                                state.round = game.currentRound;
                                state.myChoice = null;
                                state.opponentChoice = null;
                                state.roundResult = '';
                                state.waitingForOpponent = false;
                                state.animateCards = false;
                                render();
                            } else {
                                state.screen = 'finished';
                                render();
                            }
                        }, 3000);
                    }
                }
            });
        }

        function playCard(card) {
            if (state.myChoice || state.waitingForOpponent) return;

            loadGame(state.gameId, (game) => {
                const myRole = state.isHost ? 'player1' : 'player2';
                
                // –£–¥–∞–ª—è–µ–º –∫–∞—Ä—Ç—É –∏–∑ –∫–æ–ª–æ–¥—ã
                const newCards = game[myRole + 'Cards'].filter(c => {
                    if (c === card) {
                        const found = true;
                        card = null; // —É–¥–∞–ª—è–µ–º —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—É—é –Ω–∞–π–¥–µ–Ω–Ω—É—é
                        return false;
                    }
                    return true;
                });
                
                game[myRole + 'Cards'] = newCards;
                game[myRole + 'Choice'] = card || game[myRole + 'Cards'][0];
                
                state.myCards = newCards;
                state.myChoice = game[myRole + 'Choice'];
                state.waitingForOpponent = true;

                saveGame(state.gameId, game);
                render();
            });
        }

        function copyCode() {
            navigator.clipboard.writeText(state.gameId);
            const btn = event.target.closest('button');
            const originalText = btn.innerHTML;
            btn.innerHTML = '‚úì –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!';
            setTimeout(() => {
                btn.innerHTML = originalText;
            }, 2000);
        }

        function resetGame() {
            state = {
                screen: 'menu',
                gameId: '',
                playerName: '',
                isHost: false,
                myCards: [...INITIAL_DECK],
                opponentCards: 5,
                myChoice: null,
                opponentChoice: null,
                myScore: 0,
                opponentScore: 0,
                round: 1,
                opponentName: '–ü—Ä–æ—Ç–∏–≤–Ω–∏–∫',
                waitingForOpponent: false,
                roundResult: '',
                error: '',
                showModal: null,
                animateCards: false
            };
            render();
        }

        // ==================== RENDER ====================
        function render() {
            const app = document.getElementById('app');

            const createModal = state.showModal === 'create' ? `
                <div class="fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center p-4 z-50">
                    <div class="bg-gradient-to-br from-gray-800 to-gray-900 rounded-2xl p-8 max-w-md w-full shadow-2xl border border-gray-700">
                        <h2 class="text-3xl font-bold text-white mb-6 text-center">üéÆ –°–æ–∑–¥–∞—Ç—å –∏–≥—Ä—É</h2>
                        <input 
                            type="text" 
                            id="createName"
                            placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è" 
                            class="w-full bg-gray-700/50 text-white placeholder-gray-400 px-4 py-4 rounded-xl focus:outline-none focus:ring-2 focus:ring-amber-500 text-lg mb-4 border border-gray-600"
                            onkeypress="if(event.key === 'Enter') createGame()"
                        >
                        ${state.error ? `
                            <div class="bg-red-500/20 border border-red-500/40 rounded-xl p-3 mb-4">
                                <p class="text-red-200 text-sm text-center">‚ö†Ô∏è ${state.error}</p>
                            </div>
                        ` : ''}
                        <div class="flex gap-3">
                            <button onclick="createGame()" class="flex-1 bg-gradient-to-r from-amber-600 to-yellow-700 hover:from-amber-700 hover:to-yellow-800 text-white font-bold py-4 rounded-xl transition-all shadow-lg">
                                –°–æ–∑–¥–∞—Ç—å
                            </button>
                            <button onclick="closeModal()" class="flex-1 bg-gray-700 hover:bg-gray-600 text-white font-bold py-4 rounded-xl transition-all">
                                –û—Ç–º–µ–Ω–∞
                            </button>
                        </div>
                    </div>
                </div>
            ` : '';

            const joinModal = state.showModal === 'join' ? `
                <div class="fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center p-4 z-50">
                    <div class="bg-gradient-to-br from-gray-800 to-gray-900 rounded-2xl p-8 max-w-md w-full shadow-2xl border border-gray-700">
                        <h2 class="text-3xl font-bold text-white mb-6 text-center">üö™ –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è</h2>
                        <input 
                            type="text" 
                            id="joinName"
                            placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è" 
                            class="w-full bg-gray-700/50 text-white placeholder-gray-400 px-4 py-4 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 text-lg mb-4 border border-gray-600"
                        >
                        <input 
                            type="text" 
                            id="joinCode"
                            placeholder="–ö–æ–¥ –∏–≥—Ä—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä: ABC123)" 
                            class="w-full bg-gray-700/50 text-white placeholder-gray-400 px-4 py-4 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 text-lg mb-4 uppercase border border-gray-600"
                            onkeypress="if(event.key === 'Enter') joinGame()"
                        >
                        ${state.error ? `
                            <div class="bg-red-500/20 border border-red-500/40 rounded-xl p-3 mb-4">
                                <p class="text-red-200 text-sm text-center">‚ö†Ô∏è ${state.error}</p>
                            </div>
                        ` : ''}
                        <div class="flex gap-3">
                            <button onclick="joinGame()" class="flex-1 bg-gradient-to-r from-blue-600 to-indigo-700 hover:from-blue-700 hover:to-indigo-800 text-white font-bold py-4 rounded-xl transition-all shadow-lg">
                                –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è
                            </button>
                            <button onclick="closeModal()" class="flex-1 bg-gray-700 hover:bg-gray-600 text-white font-bold py-4 rounded-xl transition-all">
                                –û—Ç–º–µ–Ω–∞
                            </button>
                        </div>
                    </div>
                </div>
            ` : '';

            if (state.screen === 'menu') {
                app.innerHTML = `
                    <div class="min-h-screen flex items-center justify-center p-4">
                        <div class="bg-gray-800/50 backdrop-blur-md rounded-3xl p-8 max-w-md w-full shadow-2xl border border-gray-700">
                            <h1 class="text-5xl font-bold text-white text-center mb-3">‚öîÔ∏è –ò–º–ø–µ—Ä–∞—Ç–æ—Ä</h1>
                            <p class="text-gray-400 text-center mb-8">–ö–∞—Ä—Ç–æ—á–Ω–∞—è –∏–≥—Ä–∞ –∏–∑ –∞–Ω–∏–º–µ –ö–∞–π–¥–∑–∏</p>
                            
                            ${!isFirebaseConfigured ? `
                                <div class="bg-yellow-500/20 border border-yellow-500/40 rounded-xl p-4 mb-6">
                                    <p class="text-yellow-200 text-sm text-center">
                                        ‚ö†Ô∏è Firebase –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω. –ò–≥—Ä–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –ª–æ–∫–∞–ª—å–Ω–æ.
                                    </p>
                                </div>
                            ` : ''}
                            
                            <div class="space-y-4">
                                <button onclick="showCreateModal()" class="w-full bg-gradient-to-r from-amber-600 to-yellow-700 hover:from-amber-700 hover:to-yellow-800 text-white font-bold py-5 rounded-xl transition-all shadow-lg text-lg">
                                    üéÆ –°–æ–∑–¥–∞—Ç—å –∏–≥—Ä—É
                                </button>
                                <button onclick="showJoinModal()" class="w-full bg-gradient-to-r from-blue-600 to-indigo-700 hover:from-blue-700 hover:to-indigo-800 text-white font-bold py-5 rounded-xl transition-all shadow-lg text-lg">
                                    üö™ –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –∫ –∏–≥—Ä–µ
                                </button>
                            </div>

                            <div class="mt-8 bg-gray-700/30 rounded-xl p-5 border border-gray-600">
                                <h3 class="text-white font-bold mb-3 text-center">üìú –ü—Ä–∞–≤–∏–ª–∞</h3>
                                <div class="space-y-2 text-gray-300 text-sm">
                                    <div class="flex items-center gap-2">
                                        <span class="text-xl">üëë</span>
                                        <span>–ò–º–ø–µ—Ä–∞—Ç–æ—Ä –ø–æ–±–µ–∂–¥–∞–µ—Ç –ì—Ä–∞–∂–¥–∞–Ω–∏–Ω–∞</span>
                                    </div>
                                    <div class="flex items-center gap-2">
                                        <span class="text-xl">üë•</span>
                                        <span>–ì—Ä–∞–∂–¥–∞–Ω–∏–Ω –ø–æ–±–µ–∂–¥–∞–µ—Ç –†–∞–±–∞</span>
                                    </div>
                                    <div class="flex items-center gap-2">
                                        <span class="text-xl">üîó</span>
                                        <span>–†–∞–± –ø–æ–±–µ–∂–¥–∞–µ—Ç –ò–º–ø–µ—Ä–∞—Ç–æ—Ä–∞</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    ${createModal}
                    ${joinModal}
                `;

                setTimeout(() => {
                    if (state.showModal === 'create') {
                        document.getElementById('createName')?.focus();
                    } else if (state.showModal === 'join') {
                        document.getElementById('joinName')?.focus();
                    }
                }, 0);

            } else if (state.screen === 'lobby') {
                app.innerHTML = `
                    <div class="min-h-screen flex items-center justify-center p-4">
                        <div class="bg-gray-800/50 backdrop-blur-md rounded-3xl p-8 max-w-md w-full shadow-2xl border border-gray-700">
                            <h2 class="text-3xl font-bold text-white text-center mb-6">‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞...</h2>
                            
                            <div class="bg-gray-700/30 rounded-xl p-6 mb-6 border border-gray-600">
                                <p class="text-gray-400 text-center mb-4">–ö–æ–¥ –∏–≥—Ä—ã:</p>
                                <div class="flex items-center gap-3">
                                    <input type="text" value="${state.gameId}" readonly class="flex-1 bg-gray-700/50 text-white text-3xl font-mono font-bold text-center py-4 rounded-lg border-2 border-gray-600">
                                    <button onclick="copyCode()" class="bg-gradient-to-r from-blue-600 to-indigo-700 hover:from-blue-700 hover:to-indigo-800 text-white px-4 py-4 rounded-lg transition-all shadow-lg whitespace-nowrap">
                                        üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
                                    </button>
                                </div>
                            </div>
                            
                            <div class="bg-blue-500/20 border border-blue-500/30 rounded-xl p-4">
                                <p class="text-blue-200 text-center text-sm">
                                    üì§ –û—Ç–ø—Ä–∞–≤—å—Ç–µ —ç—Ç–æ—Ç –∫–æ–¥ –¥—Ä—É–≥—É
                                </p>
                            </div>
                            
                            <div class="mt-6 flex justify-center">
                                <div class="pulse-anim text-gray-300">–û–∂–∏–¥–∞–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è...</div>
                            </div>
                        </div>
                    </div>
                `;
            } else if (state.screen === 'playing') {
                app.innerHTML = `
                    <div class="min-h-screen p-4">
                        <div class="max-w-5xl mx-auto">
                            <div class="bg-gray-800/50 backdrop-blur-md rounded-3xl p-6 mb-6 border border-gray-700">
                                <div class="flex justify-between items-center text-white flex-wrap gap-4">
                                    <div class="text-2xl font-bold">üéØ –†–∞—É–Ω–¥ ${state.round} / 5</div>
                                    <div class="flex gap-8 text-2xl font-bold">
                                        <span class="text-emerald-400">${state.playerName}: ${state.myScore}</span>
                                        <span class="text-rose-400">${state.opponentName}: ${state.opponentScore}</span>
                                    </div>
                                </div>
                            </div>

                            <div class="space-y-6">
                                <div class="bg-gray-800/50 backdrop-blur-md rounded-2xl p-6 border border-gray-700">
                                    <h3 class="text-white font-bold text-2xl mb-4">üë§ ${state.opponentName}</h3>
                                    <div class="flex gap-3 justify-center mb-6">
                                        ${Array(state.opponentCards).fill(0).map((_, i) => 
                                            `<div class="w-20 h-32 bg-gradient-to-br from-gray-700 to-gray-900 rounded-xl shadow-lg border-2 border-gray-600 card-slide" style="animation-delay: ${i * 0.1}s"></div>`
                                        ).join('')}
                                    </div>
                                    ${state.opponentChoice ? `
                                        <div class="flex justify-center">
                                            <div class="w-24 h-36 rounded-xl shadow-2xl bg-gradient-to-br ${CARDS[state.opponentChoice].color} flex flex-col items-center justify-center text-white border-2 border-gray-600 ${state.animateCards ? 'card-flip' : ''}">
                                                <div class="text-5xl mb-2">${CARDS[state.opponentChoice].emoji}</div>
                                                <span class="text-sm font-bold">${CARDS[state.opponentChoice].name}</span>
                                            </div>
                                        </div>
                                    ` : ''}
                                </div>

                                ${state.roundResult ? `
                                    <div class="bg-gray-800/50 backdrop-blur-md rounded-2xl p-8 text-center border border-gray-700 card-slide">
                                        <h3 class="text-white text-3xl font-bold">${state.roundResult}</h3>
                                    </div>
                                ` : ''}

                                ${state.waitingForOpponent && !state.roundResult ? `
                                    <div class="bg-blue-500/20 backdrop-blur-md rounded-2xl p-6 text-center border border-blue-500/30">
                                        <h3 class="text-blue-200 text-xl pulse-anim">‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ —Ö–æ–¥–∞ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞...</h3>
                                    </div>
                                ` : ''}

                                <div class="bg-gray-800/50 backdrop-blur-md rounded-2xl p-6 border border-gray-700">
                                    <h3 class="text-white font-bold text-2xl mb-4">üéÆ ${state.playerName} (–í—ã)</h3>
                                    ${state.myChoice ? `
                                        <div class="flex justify-center">
                                            <div class="w-24 h-36 rounded-xl shadow-2xl bg-gradient-to-br ${CARDS[state.myChoice].color} flex flex-col items-center justify-center text-white border-2 border-gray-600 ${state.animateCards ? 'card-flip' : ''}">
                                                <div class="text-5xl mb-2">${CARDS[state.myChoice].emoji}</div>
                                                <span class="text-sm font-bold">${CARDS[state.myChoice].name}</span>
                                            </div>
                                        </div>
                                    ` : `
                                        <p class="text-gray-400 text-center mb-4">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ä—Ç—É:</p>
                                        <div class="flex gap-3 justify-center flex-wrap">
                                            ${state.myCards.map((card, i) => `
                                                <div onclick="playCard('${card}')" class="${state.waitingForOpponent ? 'opacity-50' : 'cursor-pointer card-hover'} w-24 h-36 rounded-xl shadow-2xl bg-gradient-to-br ${CARDS[card].color} flex flex-col items-center justify-center text-white border-2 border-gray-600 card-slide" style="animation-delay: ${i * 0.1}s">
                                                    <div class="text-5xl mb-2">${CARDS[card].emoji}</div>
                                                    <span class="text-sm font-bold">${CARDS[card].name}</span>
                                                </div>
                                            `).join('')}
                                        </div>
                                    `}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            } else if (state.screen === 'finished') {
                const iWon = state.myScore > state.opponentScore;
                const isDraw = state.myScore === state.opponentScore;
                
                app.innerHTML = `
                    <div class="min-h-screen flex items-center justify-center p-4">
                        <div class="bg-gray-800/50 backdrop-blur-md rounded-3xl p-8 max-w-md w-full shadow-2xl border border-gray-700 card-slide">
                            <h2 class="text-5xl font-bold text-white text-center mb-8">
                                ${isDraw ? '‚öñÔ∏è –ù–∏—á—å—è!' : iWon ? 'üéâ –ü–æ–±–µ–¥–∞!' : 'üòî –ü–æ—Ä–∞–∂–µ–Ω–∏–µ'}
                            </h2>
                            
                            <div class="bg-gray-700/30 rounded-xl p-6 mb-6 border border-gray-600">
                                <div class="text-center mb-4">
                                    <div class="text-6xl font-bold text-white mb-2">${state.myScore} : ${state.opponentScore}</div>
                                    <div class="flex justify-between text-gray-400 text-sm">
                                        <span>${state.playerName}</span>
                                        <span>${state.opponentName}</span>
                                    </div>
                                </div>
                            </div>
                            
                            <button onclick="resetGame()" class="w-full bg-gradient-to-r from-blue-600 to-indigo-700 hover:from-blue-700 hover:to-indigo-800 text-white font-bold py-5 rounded-xl transition-all shadow-lg text-lg">
                                üè† –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –º–µ–Ω—é
                            </button>
                        </div>
                    </div>
                `;
            }
        }

        render();
    </script>
</body>
</html>
