<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ò–º–ø–µ—Ä–∞—Ç–æ—Ä - –ö–∞—Ä—Ç–æ—á–Ω–∞—è –∏–≥—Ä–∞</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
</head>
<body class="bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 min-h-screen">
    <div id="app"></div>

    <script>
        // ==================== FIREBASE CONFIG ====================
        // –ó–ê–ú–ï–ù–ò–¢–ï –ù–ê –°–í–û–ò –î–ê–ù–ù–´–ï –ò–ó FIREBASE CONSOLE
        const firebaseConfig = {
  apiKey: "AIzaSyBFjleDsbPvsNnlkKp9q5a-Xq3IyTus23o",
  authDomain: "card-game-d1fa1.firebaseapp.com",
  databaseURL: "https://card-game-d1fa1-default-rtdb.firebaseio.com",
  projectId: "card-game-d1fa1",
  storageBucket: "card-game-d1fa1.firebasestorage.app",
  messagingSenderId: "897674662962",
  appId: "1:897674662962:web:c7824186c666e30cacd82b",
  measurementId: "G-W9KWPSR8K8"
};

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∫–æ–Ω—Ñ–∏–≥ –∑–∞–ø–æ–ª–Ω–µ–Ω)
        let database = null;
        const isFirebaseConfigured = firebaseConfig.apiKey !== "YOUR_API_KEY_HERE";
        
        if (isFirebaseConfigured) {
            firebase.initializeApp(firebaseConfig);
            database = firebase.database();
        }

        // ==================== GAME LOGIC ====================
        const CARDS = {
            E: { name: '–ò–º–ø–µ—Ä–∞—Ç–æ—Ä', emoji: 'üëë', color: 'bg-yellow-600', beats: 'C' },
            C: { name: '–ì—Ä–∞–∂–¥–∞–Ω–∏–Ω', emoji: 'üë•', color: 'bg-blue-600', beats: 'S' },
            S: { name: '–†–∞–±', emoji: 'üîó', color: 'bg-gray-600', beats: 'E' }
        };

        const INITIAL_DECK = ['E', 'S', 'C', 'C', 'C'];

        let state = {
            screen: 'menu',
            gameId: '',
            playerName: '',
            isHost: false,
            myCards: [...INITIAL_DECK],
            opponentCards: 5,
            myChoice: null,
            opponentChoice: null,
            myScore: 0,
            opponentScore: 0,
            round: 1,
            opponentName: '–ü—Ä–æ—Ç–∏–≤–Ω–∏–∫',
            waitingForOpponent: false,
            roundResult: '',
            error: ''
        };

        // ==================== FIREBASE FUNCTIONS ====================
        function saveGame(gameId, data) {
            if (database) {
                database.ref('games/' + gameId).set(data);
            } else {
                localStorage.setItem('game_' + gameId, JSON.stringify(data));
                window.dispatchEvent(new Event('storage'));
            }
        }

        function watchGame(gameId, callback) {
            if (database) {
                database.ref('games/' + gameId).on('value', (snapshot) => {
                    callback(snapshot.val());
                });
            } else {
                const interval = setInterval(() => {
                    const data = localStorage.getItem('game_' + gameId);
                    if (data) callback(JSON.parse(data));
                }, 500);
                return () => clearInterval(interval);
            }
        }

        function loadGame(gameId, callback) {
            if (database) {
                database.ref('games/' + gameId).once('value').then((snapshot) => {
                    callback(snapshot.val());
                });
            } else {
                const data = localStorage.getItem('game_' + gameId);
                callback(data ? JSON.parse(data) : null);
            }
        }

        // ==================== GAME FUNCTIONS ====================
        function determineWinner(card1, card2) {
            if (card1 === card2) return 'draw';
            if (CARDS[card1].beats === card2) return 'player';
            return 'opponent';
        }

        function createGame() {
            const name = prompt('–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è:');
            if (!name) return;

            const gameId = Math.random().toString(36).substr(2, 6).toUpperCase();
            const gameData = {
                player1Name: name.trim(),
                player2Name: null,
                currentRound: 1,
                player1Choice: null,
                player2Choice: null,
                createdAt: Date.now()
            };

            saveGame(gameId, gameData);

            state.gameId = gameId;
            state.playerName = name.trim();
            state.isHost = true;
            state.screen = 'lobby';
            state.myCards = [...INITIAL_DECK];
            
            render();
            startWatching();
        }

        function joinGame() {
            const name = prompt('–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è:');
            if (!name) return;

            const gameId = prompt('–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –∏–≥—Ä—ã:')?.toUpperCase();
            if (!gameId) return;

            loadGame(gameId, (game) => {
                if (!game) {
                    alert('–ò–≥—Ä–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
                    return;
                }

                if (game.player2Name) {
                    alert('–ò–≥—Ä–∞ —É–∂–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∞');
                    return;
                }

                game.player2Name = name.trim();
                saveGame(gameId, game);

                state.gameId = gameId;
                state.playerName = name.trim();
                state.opponentName = game.player1Name;
                state.isHost = false;
                state.screen = 'playing';
                state.myCards = [...INITIAL_DECK];

                render();
                startWatching();
            });
        }

        function startWatching() {
            watchGame(state.gameId, (game) => {
                if (!game) return;

                if (state.screen === 'lobby' && game.player2Name) {
                    state.opponentName = game.player2Name;
                    state.screen = 'playing';
                    render();
                }

                if (state.screen === 'playing') {
                    const myRole = state.isHost ? 'player1' : 'player2';
                    const oppRole = state.isHost ? 'player2' : 'player1';

                    if (game[myRole + 'Choice'] && game[oppRole + 'Choice'] && !state.opponentChoice) {
                        const myCard = game[myRole + 'Choice'];
                        const oppCard = game[oppRole + 'Choice'];

                        state.myChoice = myCard;
                        state.opponentChoice = oppCard;
                        state.waitingForOpponent = false;

                        const winner = determineWinner(myCard, oppCard);
                        if (winner === 'player') {
                            state.myScore++;
                            state.roundResult = '–í—ã –ø–æ–±–µ–¥–∏–ª–∏ –≤ —Ä–∞—É–Ω–¥–µ! üéâ';
                        } else if (winner === 'opponent') {
                            state.opponentScore++;
                            state.roundResult = '–ü—Ä–æ—Ç–∏–≤–Ω–∏–∫ –ø–æ–±–µ–¥–∏–ª üòî';
                        } else {
                            state.roundResult = '–ù–∏—á—å—è ‚öñÔ∏è';
                        }

                        render();

                        setTimeout(() => {
                            if (game.currentRound < 5) {
                                game.currentRound++;
                                game.player1Choice = null;
                                game.player2Choice = null;
                                saveGame(state.gameId, game);

                                state.round = game.currentRound;
                                state.myChoice = null;
                                state.opponentChoice = null;
                                state.roundResult = '';
                                state.waitingForOpponent = false;
                                render();
                            } else {
                                state.screen = 'finished';
                                render();
                            }
                        }, 3000);
                    }
                }
            });
        }

        function playCard(card) {
            if (state.myChoice || state.waitingForOpponent) return;

            loadGame(state.gameId, (game) => {
                state.myCards = state.myCards.filter(c => c !== card);
                state.myChoice = card;
                state.opponentCards--;
                state.waitingForOpponent = true;

                const myRole = state.isHost ? 'player1' : 'player2';
                game[myRole + 'Choice'] = card;
                saveGame(state.gameId, game);

                render();
            });
        }

        function copyCode() {
            navigator.clipboard.writeText(state.gameId);
            alert('–ö–æ–¥ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω: ' + state.gameId);
        }

        function resetGame() {
            state = {
                screen: 'menu',
                gameId: '',
                playerName: '',
                isHost: false,
                myCards: [...INITIAL_DECK],
                opponentCards: 5,
                myChoice: null,
                opponentChoice: null,
                myScore: 0,
                opponentScore: 0,
                round: 1,
                opponentName: '–ü—Ä–æ—Ç–∏–≤–Ω–∏–∫',
                waitingForOpponent: false,
                roundResult: '',
                error: ''
            };
            render();
        }

        // ==================== RENDER ====================
        function render() {
            const app = document.getElementById('app');

            if (state.screen === 'menu') {
                app.innerHTML = `
                    <div class="min-h-screen flex items-center justify-center p-4">
                        <div class="bg-white/10 backdrop-blur-md rounded-3xl p-8 max-w-md w-full shadow-2xl border border-white/20">
                            <h1 class="text-5xl font-bold text-white text-center mb-3">‚öîÔ∏è –ò–º–ø–µ—Ä–∞—Ç–æ—Ä</h1>
                            <p class="text-gray-300 text-center mb-8">–ö–∞—Ä—Ç–æ—á–Ω–∞—è –∏–≥—Ä–∞ –∏–∑ –∞–Ω–∏–º–µ –ö–∞–π–¥–∑–∏</p>
                            
                            ${!isFirebaseConfigured ? `
                                <div class="bg-yellow-500/20 border border-yellow-500/40 rounded-xl p-4 mb-6">
                                    <p class="text-yellow-200 text-sm text-center">
                                        ‚ö†Ô∏è Firebase –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω. –ò–≥—Ä–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –ª–æ–∫–∞–ª—å–Ω–æ (–≤ –æ–¥–Ω–æ–º –±—Ä–∞—É–∑–µ—Ä–µ).
                                    </p>
                                </div>
                            ` : ''}
                            
                            <div class="space-y-4">
                                <button onclick="createGame()" class="w-full bg-yellow-600 hover:bg-yellow-700 text-white font-bold py-5 rounded-xl transition-all shadow-lg text-lg">
                                    üéÆ –°–æ–∑–¥–∞—Ç—å –∏–≥—Ä—É
                                </button>
                                <button onclick="joinGame()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-5 rounded-xl transition-all shadow-lg text-lg">
                                    üö™ –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –∫ –∏–≥—Ä–µ
                                </button>
                            </div>

                            <div class="mt-8 bg-white/5 rounded-xl p-5 border border-white/10">
                                <h3 class="text-white font-bold mb-3 text-center">üìú –ü—Ä–∞–≤–∏–ª–∞</h3>
                                <div class="space-y-2 text-gray-300 text-sm">
                                    <div>üëë –ò–º–ø–µ—Ä–∞—Ç–æ—Ä ‚Üí –ì—Ä–∞–∂–¥–∞–Ω–∏–Ω</div>
                                    <div>üë• –ì—Ä–∞–∂–¥–∞–Ω–∏–Ω ‚Üí –†–∞–±</div>
                                    <div>üîó –†–∞–± ‚Üí –ò–º–ø–µ—Ä–∞—Ç–æ—Ä</div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            } else if (state.screen === 'lobby') {
                app.innerHTML = `
                    <div class="min-h-screen flex items-center justify-center p-4">
                        <div class="bg-white/10 backdrop-blur-md rounded-3xl p-8 max-w-md w-full shadow-2xl border border-white/20">
                            <h2 class="text-3xl font-bold text-white text-center mb-6">‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞...</h2>
                            
                            <div class="bg-white/5 rounded-xl p-6 mb-6 border border-white/10">
                                <p class="text-gray-300 text-center mb-4">–ö–æ–¥ –∏–≥—Ä—ã:</p>
                                <div class="flex items-center gap-3">
                                    <input type="text" value="${state.gameId}" readonly class="flex-1 bg-white/10 text-white text-3xl font-mono font-bold text-center py-4 rounded-lg border-2 border-white/20">
                                    <button onclick="copyCode()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-4 rounded-lg transition-all shadow-lg">
                                        üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
                                    </button>
                                </div>
                            </div>
                            
                            <div class="bg-blue-500/20 border border-blue-500/30 rounded-xl p-4">
                                <p class="text-blue-200 text-center text-sm">
                                    üì§ –û—Ç–ø—Ä–∞–≤—å—Ç–µ —ç—Ç–æ—Ç –∫–æ–¥ –¥—Ä—É–≥—É
                                </p>
                            </div>
                        </div>
                    </div>
                `;
            } else if (state.screen === 'playing') {
                app.innerHTML = `
                    <div class="min-h-screen p-4">
                        <div class="max-w-5xl mx-auto">
                            <div class="bg-white/10 backdrop-blur-md rounded-3xl p-6 mb-6 border border-white/20">
                                <div class="flex justify-between items-center text-white flex-wrap gap-4">
                                    <div class="text-2xl font-bold">üéØ –†–∞—É–Ω–¥ ${state.round} / 5</div>
                                    <div class="flex gap-8 text-2xl font-bold">
                                        <span class="text-green-400">${state.playerName}: ${state.myScore}</span>
                                        <span class="text-red-400">${state.opponentName}: ${state.opponentScore}</span>
                                    </div>
                                </div>
                            </div>

                            <div class="space-y-6">
                                <div class="bg-white/10 backdrop-blur-md rounded-2xl p-6 border border-white/20">
                                    <h3 class="text-white font-bold text-2xl mb-4">üë§ ${state.opponentName}</h3>
                                    <div class="flex gap-3 justify-center mb-6">
                                        ${Array(state.opponentCards).fill(0).map(() => 
                                            '<div class="w-20 h-32 bg-gradient-to-br from-gray-700 to-gray-900 rounded-xl shadow-lg border-2 border-gray-600"></div>'
                                        ).join('')}
                                    </div>
                                    ${state.opponentChoice ? `
                                        <div class="flex justify-center">
                                            <div class="w-24 h-36 rounded-xl shadow-xl ${CARDS[state.opponentChoice].color} flex flex-col items-center justify-center text-white">
                                                <div class="text-5xl mb-2">${CARDS[state.opponentChoice].emoji}</div>
                                                <span class="text-sm font-bold">${CARDS[state.opponentChoice].name}</span>
                                            </div>
                                        </div>
                                    ` : ''}
                                </div>

                                ${state.roundResult ? `
                                    <div class="bg-white/10 backdrop-blur-md rounded-2xl p-8 text-center border border-white/20">
                                        <h3 class="text-white text-3xl font-bold">${state.roundResult}</h3>
                                    </div>
                                ` : ''}

                                ${state.waitingForOpponent && !state.roundResult ? `
                                    <div class="bg-blue-500/20 backdrop-blur-md rounded-2xl p-6 text-center border border-blue-500/30">
                                        <h3 class="text-blue-200 text-xl">‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ —Ö–æ–¥–∞ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞...</h3>
                                    </div>
                                ` : ''}

                                <div class="bg-white/10 backdrop-blur-md rounded-2xl p-6 border border-white/20">
                                    <h3 class="text-white font-bold text-2xl mb-4">üéÆ ${state.playerName} (–í—ã)</h3>
                                    ${state.myChoice ? `
                                        <div class="flex justify-center">
                                            <div class="w-24 h-36 rounded-xl shadow-xl ${CARDS[state.myChoice].color} flex flex-col items-center justify-center text-white">
                                                <div class="text-5xl mb-2">${CARDS[state.myChoice].emoji}</div>
                                                <span class="text-sm font-bold">${CARDS[state.myChoice].name}</span>
                                            </div>
                                        </div>
                                    ` : `
                                        <p class="text-gray-300 text-center mb-4">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ä—Ç—É:</p>
                                        <div class="flex gap-3 justify-center flex-wrap">
                                            ${state.myCards.map(card => `
                                                <div onclick="playCard('${card}')" class="${state.waitingForOpponent ? 'opacity-50' : 'cursor-pointer hover:scale-110 transition-all'} w-24 h-36 rounded-xl shadow-xl ${CARDS[card].color} flex flex-col items-center justify-center text-white">
                                                    <div class="text-5xl mb-2">${CARDS[card].emoji}</div>
                                                    <span class="text-sm font-bold">${CARDS[card].name}</span>
                                                </div>
                                            `).join('')}
                                        </div>
                                    `}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            } else if (state.screen === 'finished') {
                const iWon = state.myScore > state.opponentScore;
                const isDraw = state.myScore === state.opponentScore;
                
                app.innerHTML = `
                    <div class="min-h-screen flex items-center justify-center p-4">
                        <div class="bg-white/10 backdrop-blur-md rounded-3xl p-8 max-w-md w-full shadow-2xl border border-white/20">
                            <h2 class="text-5xl font-bold text-white text-center mb-8">
                                ${isDraw ? '‚öñÔ∏è –ù–∏—á—å—è!' : iWon ? 'üéâ –ü–æ–±–µ–¥–∞!' : 'üòî –ü–æ—Ä–∞–∂–µ–Ω–∏–µ'}
                            </h2>
                            
                            <div class="bg-white/5 rounded-xl p-6 mb-6 border border-white/10">
                                <div class="text-center mb-4">
                                    <div class="text-6xl font-bold text-white mb-2">${state.myScore} : ${state.opponentScore}</div>
                                    <div class="flex justify-between text-gray-300 text-sm">
                                        <span>${state.playerName}</span>
                                        <span>${state.opponentName}</span>
                                    </div>
                                </div>
                            </div>
                            
                            <button onclick="resetGame()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-5 rounded-xl transition-all shadow-lg text-lg">
                                üè† –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –º–µ–Ω—é
                            </button>
                        </div>
                    </div>
                `;
            }
        }

        // –ó–∞–ø—É—Å–∫
        render();
    </script>
</body>
</html>